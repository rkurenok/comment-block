(()=>{"use strict";function e(e){e.elements.text.value="",e.elements.display_date.value="",e.elements.display_name.value=""}class t extends Error{constructor(e,t){super(t),this.name="ValidationError",this.elem=e}}function n(e){let n,l=e.value,r=new Date,a=r.getDate(),s=r.getMonth()+1,o=r.getHours(),i=r.getMinutes(),c=-1;if(e.value.trim()){l=e.value.split(".").map((e=>Number(e))),a=l[0],s=l[1];let t=new Date(r.getFullYear(),s-1,a);c=(r-t)/1e3/60/60/24}else c=0;if(isNaN(c)||a<=0||a>31||s<=0||s>12)throw new t([e],"* Неверный формат (пример даты: 30.05)");return[a,s,o,i]=[a,s,o,i].map((e=>String(e).padStart(2,"0"))),n=c>1&&c<2?"Вчера, ":c<1&&c>=0?"Сегодня, ":`${a}.${s}, `,n+`${o}:${i}`}function l(e){let l=[];for(let t of e){if("display_date"==t.name)try{t.setAttribute("data-time",n(t))}catch(e){throw e}t.value.trim()||t.dataset.time||l.push(t)}if(0!=l.length)throw new t(l,"* Поле не может быть пустым");return e}function r(){const e=this.closest("#addPost");let t=[e.elements.text,e.elements.display_date,e.elements.display_name];try{t=l(t)}catch(e){throw e}return t}function a(){let e,t,n,l;try{[e,t,n]=r.bind(this)()}catch(e){throw e}if(this.closest(".textarea").nextElementSibling){const e=this.closest(".textarea").nextElementSibling;l="DIV"==e.tagName?e.firstChild:e}else l=s("ul","post-list");let a=s("li","post");l&&l.append(a);let o=s("div","post-content");a.append(o);let i=s("div","post-header");o.append(i);let c=s("span","post-author");i.append(c),c.innerHTML=n.value;let d=s("span","post-date");i.append(d),d.innerHTML=t.dataset.time;let u=s("div","post-body");o.append(u);let m=s("div","post-message");u.append(m);let f=document.createElement("div");m.append(f);let h=document.createElement("p");f.append(h),h.innerHTML=e.value;let y=s("div","post-footer");o.append(y);let g=s("menu","post-footer__menu");y.append(g);let v=s("li","post-like");g.append(v);let E=s("i","fa");var L;E.classList.add("fa-heart-o"),v.append(E),(L=E).addEventListener("click",(e=>{L.classList.toggle("fa-heart-o"),L.classList.toggle("fa-heart"),L.classList.contains("fa-heart")?L.style.color="red":L.style.color=""}));let A=s("li","reply");g.append(A);let x=s("a","post-footer__action");x.setAttribute("href","#"),A.append(x),p(x);let S=s("span","text");x.append(S),S.textContent="Ответить";let _=s("div","post-delete");o.append(_);let b=s("a","trash");_.append(b);let w=s("i","fa");if(w.classList.add("fa-trash-o"),b.append(w),function(e){e.addEventListener("click",(t=>{const n=e.closest(".post-content").querySelector(".post-message p");n.classList.add("deleted"),n.innerHTML="Это сообщение было удалено пользователем.",e.style.display="none"}))}(w),this.closest(".post")){let e=this.closest(".textarea").nextElementSibling;return e?e.querySelector(".post-list").append(a):(e=s("div","children"),this.closest(".textarea").after(e),e.append(l)),e}return l}function s(e,t){let n=document.createElement(e);return n.classList.add(t),n}function o(){const e=document.querySelectorAll(".post");var t,n,l;document.querySelector(".comments__count > span").innerHTML=`${e.length} `+(t=e.length,n=["комментарий","комментария","комментариев"],l=(t=Math.abs(t)%100)%10,t>10&&t<20?n[2]:l>1&&l<5?n[1]:1==l?n[0]:n[2])}function i(e,t){e.classList.add("error");let n=e.parentElement.parentElement;n.classList.add("error"),n.parentElement.firstElementChild.innerHTML=t.message}function c(t){t.addEventListener("click",(n=>{n.preventDefault();const l=t.closest(".textarea").querySelectorAll(".error");for(let e of l)"SPAN"==e.tagName?e.innerHTML="":e.classList.remove("error");try{let n=a.bind(t);const l=t.closest(".textarea");l.after(n()),e(l.firstElementChild),l.querySelector(".textarea-text").style="height:151px;overflow-y:hidden;";const r=t.closest(".textarea").querySelectorAll(".error");for(let e of r)"SPAN"==e.tagName?e.innerHTML="":e.classList.remove("error");const s=document.querySelectorAll(".post-actions__button");s.length>1&&t!=s[0]&&l.remove(),o()}catch(e){if("ValidationError"==e.name)for(let t of e.elem)i(t,e);else console.log(e)}}))}function d(e){let t=e.elements.text,r=e.elements.display_date,a=e.elements.display_name;[t,r,a].forEach((e=>{e.addEventListener("input",(t=>{try{"display_date"==e.name&&r.setAttribute("data-time",n(r)),[e]=l([e]),e.classList.remove("error");let t=e.parentElement.parentElement;t.classList.remove("error"),t.parentElement.firstElementChild.innerHTML=""}catch(t){i(e,t)}}))}))}function p(t){t.addEventListener("click",(t=>{const n=t.target.closest(".post-content");if(n.nextElementSibling&&n.nextElementSibling.classList.contains("textarea"))return!1;let l=document.querySelector("div.textarea").cloneNode(!0);e(l.firstElementChild),c(l.querySelector(".post-actions__button")),d(l.firstElementChild),l.querySelectorAll(".error").forEach((e=>{"SPAN"==e.tagName?e.innerHTML="":e.classList.remove("error")})),l.querySelector(".textarea-text").style="height:151px;overflow-y:hidden;",n.after(l)}))}window.onload=()=>{!function(e){let t=new Image;t.onload=t.onerror=function(){!function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}(),o(),function(){const e=document.querySelector(".post-actions__button"),t=document.querySelectorAll("a.post-footer__action"),n=document.querySelector("form#addPost"),l=document.querySelector("textarea");var r;c(e),t.forEach((e=>{p(e)})),d(n),document.addEventListener("keydown",(e=>{"Enter"!=e.key||e.shiftKey||(e.preventDefault(),document.activeElement.closest("form#addPost").querySelector(".post-actions__button").click())})),(r=l).setAttribute("style","height:"+(r.scrollHeight+36)+"px;overflow-y:hidden;"),r.addEventListener("input",(e=>{r.style.height=0,r.style.height=r.scrollHeight+"px",console.log(r.scrollHeight)}),!1)}()}})();