(()=>{"use strict";class e extends Error{constructor(e,t){super(t),this.name="ValidationError",this.elem=e}}function t(t){let n,a=t.value,s=new Date,l=s.getDate(),o=s.getMonth()+1,r=s.getHours(),c=s.getMinutes(),d=-1;if(t.value.trim()){a=t.value.split(".").map((e=>Number(e))),l=a[0],o=a[1];let e=new Date(s.getFullYear(),o-1,l);d=(s-e)/1e3/60/60/24}else d=0;if(isNaN(d)||l<=0||l>31||o<=0||o>12)throw new e([t],"* Неверный формат (пример даты: 30.05)");return[l,o,r,c]=[l,o,r,c].map((e=>String(e).padStart(2,"0"))),n=d>1&&d<2?"Вчера, ":d<1&&d>=0?"Сегодня, ":`${l}.${o}, `,n+`${r}:${c}`}function n(n){let a=[];for(let e of n){if("display_date"==e.name)try{e.setAttribute("data-time",t(e))}catch(e){throw e}e.value.trim()||e.dataset.time||a.push(e)}if(0!=a.length)throw new e(a,"* Поле не может быть пустым");return n}function a(){const e=this.closest("#addPost");let t=[e.elements.text,e.elements.display_date,e.elements.display_name];try{t=n(t)}catch(e){throw e}return t}function s(e){e.elements.text.value="",e.elements.display_date.value="",e.elements.display_name.value=""}function l(){const e=document.querySelectorAll(".post");var t,n,a;document.querySelector(".comments__count > span").innerHTML=`${e.length} `+(t=e.length,n=["комментарий","комментария","комментариев"],a=(t=Math.abs(t)%100)%10,t>10&&t<20?n[2]:a>1&&a<5?n[1]:1==a?n[0]:n[2])}function o(e,t){e.classList.add("error");let n=e.parentElement.parentElement;n.classList.add("error"),n.parentElement.firstElementChild.innerHTML=t.message}function r(e){e.addEventListener("click",(t=>{t.preventDefault();const n=e.closest(".textarea").querySelectorAll(".error");for(let e of n)"SPAN"==e.tagName?e.innerHTML="":e.classList.remove("error");try{let t=i.bind(e);const n=e.closest(".textarea");n.after(t()),s(n.firstElementChild),n.querySelector(".textarea-text").style="height:151px;overflow-y:hidden;";const a=document.querySelectorAll(".post-actions__button");a.length>1&&e!=a[0]&&n.remove(),l()}catch(e){if("ValidationError"==e.name)for(let t of e.elem)o(t,e);else console.log(e)}}))}function c(e){let a=e.elements.text,s=e.elements.display_date,l=e.elements.display_name;[a,s,l].forEach((e=>{e.addEventListener("input",(a=>{try{"display_date"==e.name&&s.setAttribute("data-time",t(s)),[e]=n([e]),e.classList.remove("error");let a=e.parentElement.parentElement;a.classList.remove("error"),a.parentElement.firstElementChild.innerHTML=""}catch(a){o(e,a)}}))}))}function d(e){e.addEventListener("click",(e=>{const t=e.target.closest(".post-content");if(t.nextElementSibling&&t.nextElementSibling.classList.contains("textarea"))return!1;let n=document.querySelector("div.textarea").cloneNode(!0);s(n.firstElementChild),r(n.querySelector(".post-actions__button")),c(n.firstElementChild),n.querySelectorAll(".error").forEach((e=>{"SPAN"==e.tagName?e.innerHTML="":e.classList.remove("error")})),n.querySelector(".textarea-text").style="height:151px;overflow-y:hidden;",t.after(n)}))}function i(){let e,t,n,s;try{[e,t,n]=a.bind(this)()}catch(e){throw e}if(this.closest(".textarea").nextElementSibling){const e=this.closest(".textarea").nextElementSibling;s="DIV"==e.tagName?e.firstChild:e}else s=document.createElement("ul"),s.classList.add("post-list");let l=document.createElement("li");l.classList.add("post"),s&&s.append(l);let o=document.createElement("div");o.classList.add("post-content"),l.append(o);let r=document.createElement("div");r.classList.add("post-header"),o.append(r);let c=document.createElement("span");c.classList.add("post-author"),r.append(c),c.innerHTML=n.value;let i=document.createElement("span");i.classList.add("post-date"),r.append(i),i.innerHTML=t.dataset.time;let m=document.createElement("div");m.classList.add("post-body"),o.append(m);let p=document.createElement("div");p.classList.add("post-message"),m.append(p);let u=document.createElement("div");p.append(u);let h=document.createElement("p");u.append(h),h.innerHTML=e.value;let f=document.createElement("div");f.classList.add("post-footer"),o.append(f);let E=document.createElement("menu");E.classList.add("post-footer__menu"),f.append(E);let L=document.createElement("li");L.classList.add("post-like"),E.append(L);let y=document.createElement("i");var g;y.classList.add("fa"),y.classList.add("fa-heart-o"),L.append(y),(g=y).addEventListener("click",(e=>{g.classList.toggle("fa-heart-o"),g.classList.toggle("fa-heart"),g.classList.contains("fa-heart")?g.style.color="red":g.style.color=""}));let v=document.createElement("li");v.classList.add("reply"),E.append(v);let A=document.createElement("a");A.classList.add("post-footer__action"),A.setAttribute("href","#"),v.append(A),d(A);let x=document.createElement("span");x.classList.add("text"),A.append(x),x.textContent="Ответить";let S=document.createElement("div");S.classList.add("post-delete"),o.append(S);let _=document.createElement("a");_.classList.add("trash"),S.append(_);let b=document.createElement("i");if(b.classList.add("fa"),b.classList.add("fa-trash-o"),_.append(b),function(e){e.addEventListener("click",(t=>{const n=e.closest(".post-content").querySelector(".post-message p");n.classList.add("deleted"),n.innerHTML="Это сообщение было удалено пользователем.",e.style.display="none"}))}(b),this.closest(".post")){let e=this.closest(".textarea").nextElementSibling;return e?e.querySelector(".post-list").append(l):(e=document.createElement("div"),e.classList.add("children"),this.closest(".textarea").after(e),e.append(s)),e}return s}window.onload=()=>{!function(e){let t=new Image;t.onload=t.onerror=function(){!function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}(),l(),function(){const e=document.querySelector(".post-actions__button"),t=document.querySelectorAll("a.post-footer__action"),n=document.querySelector("form#addPost"),a=document.querySelector("textarea");var s;r(e),t.forEach((e=>{d(e)})),c(n),document.addEventListener("keydown",(e=>{"Enter"==e.key&&document.activeElement.closest("form#addPost").querySelector(".post-actions__button").click()})),(s=a).setAttribute("style","height:"+(s.scrollHeight+36)+"px;overflow-y:hidden;"),s.addEventListener("input",(e=>{s.style.height=0,s.style.height=s.scrollHeight+"px",console.log(s.scrollHeight)}),!1)}()}})();